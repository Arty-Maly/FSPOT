<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
<script>

function markResult(data) {
  var locations = [];
  for (var i = 0; i < data.result.length; i++) {
    locations.push ({
      name: data.result[i].name,
      loc: new google.maps.LatLng(data.result[i].lat, data.result[i].lng),
    });
  }

  var lat = data.center.lat;
  var lng = data.center.lng;
  var latlng = new google.maps.LatLng(lat, lng);


  var infowindow = new google.maps.InfoWindow();

  var marker, i;

  var bounds = new google.maps.LatLngBounds();
  for (i = 0; i < locations.length; i++) {  
    bounds.extend(locations[i].loc);
    marker = new google.maps.Marker({
      position: locations[i].loc,
      map: window.map,
      draggable: true,
      animation: google.maps.Animation.DROP
    });

    google.maps.event.addListener(marker, 'click', (function(marker, i) {
      return function() {
        infowindow.setContent('<h1 style="color:green;">' + data.result[i].name + '</h1>' + '<br>' + 
          data.result[i].address + '<br>' + 'Rating: ' + data.result[i].rating + '<br>' );
        infowindow.open(window.map, marker);
      }
    })(marker, i));
    marker.setMap(window.map);
  }
  window.map.panTo(latlng);
  window.map.fitBounds(bounds);

  for( i = 0; i < data.result.length; i++){
      $("#name" + i).html(data.result[i].name);
      $("#addr" + i).html(data.result[i].address);
      $("#img" + i).attr('src', data.result[i].image_url);
      $("#url" + i).prop('href', data.result[i].mobile_url);
      $("#rating" + i).attr('src', data.result[i].rating_image);
  }
}
  var addr = $('#address').val();

  $.get(
    "<%= map_search_path %>",
    {
      addr: addr
    },
    markResult
  )

function sendAddress() {
  var addr = $('#address').val();

  $.get(
    "<%= map_search_path %>",
    {
      addr: addr
    },
    markResult
  )
}


function findLocation() {
  navigator.geolocation.getCurrentPosition(showMap);
}

function showMap(position) { 
  var mapCanvas = document.getElementById('map-canvas');
// var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

  var image = 'assets/marker-3ccb249568eec97cc32c37c01d0a8cae.png';
  var latlng = new google.maps.LatLng(42.3654347, -71.258595);
  var mapOptions = {
    center: latlng,
    zoom: 14,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }
  window.map = new google.maps.Map(mapCanvas, mapOptions)
  var marker = new google.maps.Marker({
    position: latlng,
    title: "You are here",
    icon: image
  });
  marker.setMap(window.map);
}

google.maps.event.addDomListener(window, 'load', showMap);

</script>



<div id="page">
   <div id="header_nav">
      <a><%=link_to "", main_path %></a>
   </div>
</div>

<div class="banner">
 <div class="container_wrap">
  <h1>F-SPOT</h1>
  <form id ="searchAddress" action="javascript:void(0);" method="get" >
   <input type="text" id="address" name="search" placeholder="Location">
   <div class="contact_btn">
    <input type="submit"  value="Search" class="btn btn-danger" onclick="sendAddress()" >
    </div>
  </form>              
</div>
</div>


<!-- map -->    
<div class="container">
  <div  id="map-canvas" >
  </div>
</div>


<!-- list of restaurants -->
<% (0...20).each do |i| %>
  <div id="eachRestaurant" class="container" class="result">
      <div class="col-lg-3">
          <div class="inner_wrap1">
              <ul class="item_module">
                <li class="module_left"><a id="<%= "url#{i}" %>"><img class="foodImage" id="<%= "img#{i}" %>" class="img-responsive" alt=""/></a></li>
                <li class="module_right">
                  <h5 id="<%= "name#{i}" %>"></h5>
                  <p id="<%= "addr#{i}" %>"></p>
                  <img id="<%= "rating#{i}" %>" />

                </li>
               </ul>
          </div>
      </div>
</div>
<% end %>












