<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
<script>
function findLocation() {
  navigator.geolocation.getCurrentPosition(showMap);
}

function showMap(position) { 
  var mapCanvas = document.getElementById('map-canvas');
// var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
  var latlng = new google.maps.LatLng(42.3654347, -71.258595);
  geocoder = new google.maps.Geocoder();
  var mapOptions = {
    center: latlng,
    zoom: 14,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }
  window.map = new google.maps.Map(mapCanvas, mapOptions)
  var marker = new google.maps.Marker({
    position: latlng,
    title: "You are here"
  });
  marker.setMap(window.map);

  $.get(
    "<%= map_search_path %>",
    {
      addr: "waltham"
    },
    showDefault
  )

}

function codeAddress() {
  var addr = $('#address').val();
  geocoder.geocode( { 'address': addr}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });

  $.get(
    "<%= map_search_path %>",
    {
      addr: addr
    },
    showSearchResult
  )
}
function showDefault(data){
    show(data);

}

function showSearchResult(data) {
    show(data);
}

function show(data) {
  for( i = 0; i < data.result.length; i++){
      $("#name" + i).html(data.result[i].name);
      $("#addr" + i).html(data.result[i].address);
      $("#img" + i).attr('src', data.result[i].image_url);
  }

}

google.maps.event.addDomListener(window, 'load', showMap);

</script>

<div class="banner">
 <div class="container_wrap">
  <form id ="searchAddress" action="javascript:void(0);" method="get" >
   <input type="text" id="address" name="search" placeholder="Search for locations nearby">
   <div class="contact_btn">
    <input type="submit"  value="Search" class="btn btn-danger" onclick="codeAddress()" >
    </div>
  </form>              
</div>
</div>

<!-- map -->    
<div class="container">
  <div  id="map-canvas" >
  </div>
</div>

<!-- list of restaurants -->
<% (0...10).each do |i| %>
  <div class="container" class="result">
      <div class="col-lg-3">
          <div class="inner_wrap1">
              <ul class="item_module">
                <li class="module_left"><img class="foodImage" id="<%= "img#{i}" %>" class="img-responsive" alt=""/></li>
                <li class="module_right">
                  <h5 id="<%= "name#{i}" %>"></h5>
                  <p id="<%= "addr#{i}" %>"></p>
                </li>
               </ul>
          </div>
      </div>
</div>
<% end %>









